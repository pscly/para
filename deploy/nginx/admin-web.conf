# admin-web 静态站点（SPA）Nginx 示例配置
#
# 两种部署方式：
# A) 同源（推荐）：Nginx 同时托管静态文件，并反代 /api 与 /ws 到后端。
#    - 浏览器同源请求 => 基本不需要 CORS（后端可保持 cors_allowed_origins=[]）。
# B) 分离域名：admin-web 与 API 分别是不同 origin。
#    - 需要在后端配置 cors_allowed_origins allowlist。

server {
  listen 80;
  server_name admin.example;

  # 你的 build 产物目录（例如把 admin-web/dist 拷贝到这里）
  root /var/www/admin-web;
  index index.html;

  # 安全头（服务端也会加一层；Nginx 这里作为边界兜底）
  add_header X-Content-Type-Options "nosniff" always;
  add_header X-Frame-Options "DENY" always;
  add_header Referrer-Policy "no-referrer" always;
  add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=()" always;

  # SPA fallback
  location / {
    try_files $uri $uri/ /index.html;
  }

  # 静态资源缓存（按需调整，确保你的产物带 hash）
  location ~* \.(?:js|css|png|jpg|jpeg|gif|svg|ico|woff2?)$ {
    expires 7d;
    add_header Cache-Control "public, max-age=604800";
    try_files $uri =404;
  }

  # ========= 方案 A：同源反代 API/WS（取消注释即可） =========
  # upstream para_backend {
  #   server 127.0.0.1:8000;
  #   keepalive 32;
  # }
  #
  # location /api/ {
  #   proxy_pass http://para_backend;
  #   proxy_set_header Host $host;
  #   proxy_set_header X-Real-IP $remote_addr;
  #   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  #   proxy_set_header X-Forwarded-Proto $scheme;
  # }
  #
  # location /ws/ {
  #   proxy_pass http://para_backend;
  #   proxy_http_version 1.1;
  #   proxy_set_header Upgrade $http_upgrade;
  #   proxy_set_header Connection "upgrade";
  #
  #   proxy_set_header Host $host;
  #   proxy_set_header X-Real-IP $remote_addr;
  #   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  #   proxy_set_header X-Forwarded-Proto $scheme;
  # }
}
